<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Food List</title>
<style>
body {
  font-family: Arial;
  padding: 20px;
}

input, textarea, select {
  width: 100%;
  padding: 6px;
  margin: 4px 0;
}

button {
  margin-top: 6px;
  padding: 8px;
}

.food-card {
  padding: 10px;
  margin: 8px 0;
  border-radius: 8px;
}

.ingredients {
  white-space: pre-line;
  margin-top: 6px;
}

.controls {
  margin-bottom: 12px;
}
</style>
</head>
<body>

<h2>Food List</h2>

<div class="controls">
  <input id="search" placeholder="Search food..." onkeyup="render()">

  <select id="sort" onchange="render()">
    <option value="az">Sort A → Z</option>
    <option value="za">Sort Z → A</option>
  </select>

  <select id="dateFilter" onchange="render()">
    <option value="">All dates</option>
  </select>
</div>

<input id="foodName" placeholder="Food name">

<textarea id="foodIngredients" placeholder="Ingredients (one per line)"></textarea>

<input id="foodDate" type="date">

<button onclick="addFood()">Add Food</button>

<div id="foodList"></div>

<script>
let foods = JSON.parse(localStorage.getItem('foods')) || [];

function save() {
  localStorage.setItem('foods', JSON.stringify(foods));
  populateDateFilter();
}

function randomColor() {
  const colors = [
    '#fce4ec', '#e8f5e9', '#e3f2fd',
    '#fff3e0', '#f3e5f5', '#e0f7fa'
  ];
  return colors[Math.floor(Math.random() * colors.length)];
}

function addFood() {
  const name = document.getElementById('foodName').value.trim();
  const ingredientsText = document.getElementById('foodIngredients').value.trim();
  const date = document.getElementById('foodDate').value;

  if (!name || !ingredientsText) {
    alert('Enter food name and ingredients');
    return;
  }

  const ingredients = ingredientsText.split('\n').map(i => i.trim()).filter(i => i);

  foods.push({
    name,
    ingredients,
    date: date || 'No date',
    color: randomColor()
  });

  save();
  render();

  document.getElementById('foodName').value = '';
  document.getElementById('foodIngredients').value = '';
  document.getElementById('foodDate').value = '';
}

function populateDateFilter() {
  const select = document.getElementById('dateFilter');
  const dates = [...new Set(foods.map(f => f.date))].filter(d => d && d !== 'No date');

  select.innerHTML = '<option value="">All dates</option>';

  dates.forEach(date => {
    const opt = document.createElement('option');
    opt.value = date;
    opt.textContent = date;
    select.appendChild(opt);
  });
}

function render() {
  const list = document.getElementById('foodList');
  const query = document.getElementById('search').value.toLowerCase();
  const sort = document.getElementById('sort').value;
  const dateFilter = document.getElementById('dateFilter').value;

  list.innerHTML = '';

  let filtered = foods
    .filter(food => food.name.toLowerCase().includes(query));

  if (dateFilter) {
    filtered = filtered.filter(food => food.date === dateFilter);
  }

  if (sort === 'az') {
    filtered.sort((a, b) => a.name.localeCompare(b.name));
  } else {
    filtered.sort((a, b) => b.name.localeCompare(a.name));
  }

  filtered.forEach((food, index) => {
    const div = document.createElement('div');
    div.className = 'food-card';
    div.style.background = food.color;

    div.innerHTML = `
      <strong>${food.name}</strong><br>
      <small>Last eaten: ${food.date}</small>
      <div class="ingredients">${food.ingredients.join('\n')}</div>
      <button onclick="deleteFood(${index})">Delete</button>
    `;

    list.appendChild(div);
  });
}

function deleteFood(index) {
  foods.splice(index, 1);
  save();
  render();
}

save();
render();
</script>

</body>
</html>
