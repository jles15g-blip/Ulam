<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Food List</title>
<style>
body {
  font-family: Arial;
  padding: 20px;
  background: #121212;
  color: #ffffff;
}

input, select, button {
  width: 100%;
  padding: 6px;
  margin: 4px 0;
  background: #1e1e1e;
  color: #ffffff;
  border: 1px solid #333;
}

button {
  border-radius: 4px;
}

.food-card {
  padding: 10px;
  margin: 8px 0;
  border-radius: 8px;
  color: #000;
}

.ingredients {
  white-space: pre-line;
  margin-top: 6px;
}

.controls {
  margin-bottom: 12px;
}
</style>
</head>
<body>

<h2>Food List</h2>

<div class="controls">
  <input id="search" placeholder="Search food..." onkeyup="render()">

  <select id="sortName" onchange="render()">
    <option value="az">Sort Name A → Z</option>
    <option value="za">Sort Name Z → A</option>
  </select>

  <select id="sortDate" onchange="render()">
    <option value="newest">Date: Newest → Oldest</option>
    <option value="oldest">Date: Oldest → Newest</option>
  </select>

  <select id="dateFilter" onchange="render()">
    <option value="">All dates</option>
  </select>
</div>

<input id="foodName" placeholder="Food name">

<!-- Ingredient input with dropdown suggestions -->
<input id="ingredientName" list="ingredientSuggestions" placeholder="Ingredient name">
<datalist id="ingredientSuggestions"></datalist>

<select id="quantity">
  <option value="0">0</option>
  <option value="1">1</option>
  <option value="2">2</option>
  <option value="3">3</option>
  <option value="4">4</option>
  <option value="5">5</option>
  <option value="6">6</option>
  <option value="7">7</option>
  <option value="8">8</option>
  <option value="9">9</option>
</select>

<button onclick="addIngredient()">Add Ingredient</button>

<div id="ingredientList"></div>

<input id="foodDate" type="date">

<button onclick="addFood()">Save Food</button>

<div id="foodList"></div>

<script>
let foods = JSON.parse(localStorage.getItem('foods')) || [];
let ingredients = [];

function save() {
  localStorage.setItem('foods', JSON.stringify(foods));
}

function randomColor() {
  const colors = [
    '#fce4ec', '#e8f5e9', '#e3f2fd',
    '#fff3e0', '#f3e5f5', '#e0f7fa'
  ];
  return colors[Math.floor(Math.random() * colors.length)];
}

// Add ingredient with quantity (updates if exists)
function addIngredient() {
  const name = document.getElementById('ingredientName').value.trim();
  const qty = document.getElementById('quantity').value;

  if (!name) {
    alert('Enter ingredient name');
    return;
  }

  const existing = ingredients.find(i => i.name.toLowerCase() === name.toLowerCase());

  if (existing) {
    existing.qty = qty;
  } else {
    ingredients.push({ name, qty });
  }

  document.getElementById('ingredientName').value = '';
  document.getElementById('quantity').value = '0';

  renderIngredients();
  updateSuggestions();
}

// Render ingredient list (for editing before saving food)
function renderIngredients() {
  const list = document.getElementById('ingredientList');
  list.innerHTML = '';

  ingredients.forEach((ing, index) => {
    const div = document.createElement('div');
    div.innerHTML = `
      ${ing.name} - ${ing.qty}
      <button onclick="editIngredient(${index})">Edit</button>
      <button onclick="deleteIngredient(${index})">Delete</button>
    `;
    list.appendChild(div);
  });
}

function editIngredient(index) {
  const ing = ingredients[index];
  document.getElementById('ingredientName').value = ing.name;
  document.getElementById('quantity').value = ing.qty;
  ingredients.splice(index, 1);
  renderIngredients();
}

function deleteIngredient(index) {
  ingredients.splice(index, 1);
  renderIngredients();
}

// Save food with ingredients and date
function addFood() {
  const name = document.getElementById('foodName').value.trim();
  const date = document.getElementById('foodDate').value;

  if (!name || ingredients.length === 0) {
    alert('Enter food name and at least one ingredient');
    return;
  }

  foods.push({
    name,
    ingredients: [...ingredients],
    date: date || 'No date',
    color: randomColor()
  });

  ingredients = [];
  renderIngredients();
  save();
  render();

  document.getElementById('foodName').value = '';
  document.getElementById('foodDate').value = '';
}

// Suggest existing ingredients (dropdown)
function updateSuggestions() {
  const datalist = document.getElementById('ingredientSuggestions');

  const existing = [...new Set(
    foods.flatMap(f => f.ingredients.map(i => i.name))
  )];

  datalist.innerHTML = '';

  existing.forEach(name => {
    const opt = document.createElement('option');
    opt.value = name;
    datalist.appendChild(opt);
  });
}

// Copy ingredients to clipboard
function copyIngredients(text) {
  navigator.clipboard.writeText(text).then(() => {
    alert('Ingredients copied');
  });
}

// Edit food (load into form for editing)
function editFood(index) {
  const food = foods[index];

  document.getElementById('foodName').value = food.name;
  document.getElementById('foodDate').value = food.date === 'No date' ? '' : food.date;

  ingredients = [...food.ingredients];
  renderIngredients();

  foods.splice(index, 1);
  save();
  render();
}

// Delete food
function deleteFood(index) {
  foods.splice(index, 1);
  save();
  render();
}

// Date filter dropdown
function populateDateFilter() {
  const select = document.getElementById('dateFilter');
  const dates = [...new Set(foods.map(f => f.date))]
    .filter(d => d && d !== 'No date');

  select.innerHTML = '<option value="">All dates</option>';

  dates.forEach(date => {
    const opt = document.createElement('option');
    opt.value = date;
    opt.textContent = date;
    select.appendChild(opt);
  });
}

// Render food list (search, sort, filter)
function render() {
  const list = document.getElementById('foodList');
  const query = document.getElementById('search').value.toLowerCase();
  const sortName = document.getElementById('sortName').value;
  const sortDate = document.getElementById('sortDate').value;
  const dateFilter = document.getElementById('dateFilter').value;

  list.innerHTML = '';

  let filtered = foods.filter(food =>
    food.name.toLowerCase().includes(query)
  );

  if (dateFilter) {
    filtered = filtered.filter(food => food.date === dateFilter);
  }

  filtered.sort((a, b) => {
    const da = a.date === 'No date' ? 0 : new Date(a.date).getTime();
    const db = b.date === 'No date' ? 0 : new Date(b.date).getTime();

    return sortDate === 'newest' ? db - da : da - db;
  });

  if (sortName === 'az') {
    filtered.sort((a, b) => a.name.localeCompare(b.name));
  } else {
    filtered.sort((a, b) => b.name.localeCompare(a.name));
  }

  list.innerHTML = '';

  filtered.forEach((food, index) => {
    const div = document.createElement('div');
    div.className = 'food-card';
    div.style.background = food.color;

    const ingredientsText = food.ingredients
      .map(i => `${i.name} - ${i.qty}`)
      .join('\n');

    div.innerHTML = `
      <strong>${food.name}</strong><br>
      <small>Last eaten: ${food.date}</small>
      <div class="ingredients">${ingredientsText}</div>

      <button onclick="copyIngredients('${ingredientsText.replace(/'/g, "\\'")}')">
        Copy Ingredients
      </button>

      <button onclick="editFood(${index})">Edit</button>
      <button onclick="deleteFood(${index})">Delete</button>
    `;

    list.appendChild(div);
  });

  updateSuggestions();
}

save();
render();
</script>

</body>
</html>
