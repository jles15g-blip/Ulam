<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Leslie's food list</title>
<style>
body {
  font-family: Arial;
  padding: 20px;
  background: #121212;
  color: #ffffff;
}

/* Filter panel */
#filterPanel {
  display: none;
  margin-bottom: 12px;
  background: #1e1e1e;
  padding: 8px;
  border-radius: 6px;
}

/* Search */
#search {
  width: 100%;
  padding: 6px;
  background: white;
  color: black;
}

/* Ingredient input row */
.input-row {
  display: flex;
  gap: 6px;
  align-items: center;
}

/* Ingredient name (autocomplete) */
#ingredientName {
  flex: 1;
  background: white;
  color: black;
  border: 1px solid #ccc;
  padding: 6px;
}

/* Quantity dropdown */
#quantity {
  width: 60px;
  background: white;
  color: black;
  border: 1px solid #ccc;
  padding: 6px;
}

/* Unit dropdown */
#unit {
  width: 100px;
  background: white;
  color: black;
  border: 1px solid #ccc;
  padding: 6px;
}

/* Date box with label */
.date-label {
  margin-top: 8px;
}

#foodDate {
  background: white;
  color: black;
  border: 1px solid #ccc;
  padding: 6px;
}

/* Buttons */
button {
  border-radius: 4px;
  cursor: pointer;
}

#addIngredientBtn {
  background: #2e7d32;
  color: white;
  border: none;
  padding: 6px;
  margin-top: 4px;
}

#saveFoodBtn {
  background: #f57c00;
  color: white;
  border: none;
  padding: 8px;
  margin-top: 8px;
}

/* Cards */
.food-card {
  padding: 10px;
  margin: 8px 0;
  border-radius: 8px;
  color: #000;
  background: #fce4ec;
}

.ingredients {
  white-space: pre-line;
  margin-top: 6px;
}

/* Card buttons */
button.copy-btn {
  background: #1976d2;
  color: white;
}

button.edit-btn {
  background: #388e3c;
  color: white;
}

button.delete-btn {
  background: #d32f2f;
  color: white;
}
</style>
</head>
<body>

<h2>Leslie's food list</h2>

<!-- Filter toggle -->
<button onclick="toggleFilters()">Filters</button>

<div id="filterPanel">
  <input id="search" placeholder="Search food...">
  <button onclick="render()">Search</button>

  <select id="sortName" onchange="render()">
    <option value="az">Sort Name A → Z</option>
    <option value="za">Sort Name Z → A</option>
  </select>

  <select id="sortDate" onchange="render()">
    <option value="newest">Date: Newest → Oldest</option>
    <option value="oldest">Date: Oldest → Newest</option>
  </select>

  <select id="dateFilter" onchange="render()">
    <option value="">All dates</option>
  </select>
</div>

<!-- Food name -->
<input id="foodName" placeholder="Food name">

<!-- Ingredient row -->
<div class="input-row">
  <input id="ingredientName" list="ingredientSuggestions" placeholder="Ingredient">
  <datalist id="ingredientSuggestions"></datalist>

  <input id="quantity" type="number" min="1" max="9" value="1">

  <select id="unit">
    <option value="pack">pack</option>
    <option value="packs">packs</option>
    <option value="tin">tin</option>
    <option value="tins">tins</option>
    <option value="carton">carton</option>
    <option value="cartons">cartons</option>
  </select>
</div>

<button id="addIngredientBtn" onclick="addIngredient()">Add Ingredient</button>

<div id="ingredientList"></div>

<!-- Date with label -->
<div class="date-label">Date:</div>
<input id="foodDate" type="date">

<!-- Save food -->
<button id="saveFoodBtn" onclick="addFood()">Save Food</button>

<div id="foodList"></div>

<script>
let foods = JSON.parse(localStorage.getItem('foods')) || [];
let ingredients = [];

// Save
function save() {
  localStorage.setItem('foods', JSON.stringify(foods));
}

// Toggle filters
function toggleFilters() {
  const panel = document.getElementById('filterPanel');
  panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
}

// Random card color
function randomColor() {
  const colors = [
    '#fce4ec', '#e8f5e9', '#e3f2fd',
    '#fff3e0', '#f3e5f5', '#e0f7fa'
  ];
  return colors[Math.floor(Math.random() * colors.length)];
}

// Add ingredient (quantity + unit)
function addIngredient() {
  const name = document.getElementById('ingredientName').value.trim();
  const qty = document.getElementById('quantity').value;
  const unit = document.getElementById('unit').value;

  if (!name) {
    alert('Enter ingredient name');
    return;
  }

  const existing = ingredients.find(i => i.name.toLowerCase() === name.toLowerCase());

  if (existing) {
    existing.qty = qty;
    existing.unit = unit;
  } else {
    ingredients.push({ name, qty, unit });
  }

  document.getElementById('ingredientName').value = '';
  document.getElementById('quantity').value = '1';

  renderIngredients();
  updateSuggestions();
}

// Render ingredient list
function renderIngredients() {
  const list = document.getElementById('ingredientList');
  list.innerHTML = '';

  ingredients.forEach((ing, index) => {
    const div = document.createElement('div');
    div.style.background = '#2e7d32';
    div.style.padding = '6px';
    div.style.margin = '4px 0';
    div.style.borderRadius = '4px';

    div.innerHTML = `
      ${ing.qty} ${ing.unit} ${ing.name}
      <button onclick="editIngredient(${index})">Edit</button>
      <button onclick="deleteIngredient(${index})">Delete</button>
    `;
    list.appendChild(div);
  });
}

function editIngredient(index) {
  const ing = ingredients[index];
  document.getElementById('ingredientName').value = ing.name;
  document.getElementById('quantity').value = ing.qty;
  document.getElementById('unit').value = ing.unit;
  ingredients.splice(index, 1);
  renderIngredients();
}

function deleteIngredient(index) {
  ingredients.splice(index, 1);
  renderIngredients();
}

// Add food
function addFood() {
  const name = document.getElementById('foodName').value.trim();
  const date = document.getElementById('foodDate').value;

  if (!name || ingredients.length === 0) {
    alert('Enter food name and at least one ingredient');
    return;
  }

  foods.push({
    name,
    ingredients: [...ingredients],
    date: date || 'No date',
    color: randomColor()
  });

  ingredients = [];
  renderIngredients();
  save();
  render();

  document.getElementById('foodName').value = '';
  document.getElementById('foodDate').value = '';
}

// Suggestions (autocomplete)
function updateSuggestions() {
  const datalist = document.getElementById('ingredientSuggestions');

  const existing = [...new Set(
    foods.flatMap(f => f.ingredients.map(i => i.name))
  )];

  datalist.innerHTML = '';

  existing.forEach(name => {
    const opt = document.createElement('option');
    opt.value = name;
    datalist.appendChild(opt);
  });
}

// Copy ingredients (WORKING)
function copyIngredients(text) {
  const textarea = document.createElement('textarea');
  textarea.value = text;
  document.body.appendChild(textarea);
  textarea.select();
  document.execCommand('copy');
  document.body.removeChild(textarea);
  alert('Copied — paste in Messenger');
}

// Edit food
function editFood(index) {
  const food = foods[index];

  document.getElementById('foodName').value = food.name;
  document.getElementById('foodDate').value = food.date === 'No date' ? '' : food.date;

  ingredients = [...food.ingredients];
  renderIngredients();

  foods.splice(index, 1);
  save();
  render();
}

// Delete food
function deleteFood(index) {
  foods.splice(index, 1);
  save();
  render();
}

// Date filter dropdown
function populateDateFilter() {
  const select = document.getElementById('dateFilter');
  const dates = [...new Set(foods.map(f => f.date))]
    .filter(d => d && d !== 'No date');

  select.innerHTML = '<option value="">All dates</option>';

  dates.forEach(date => {
    const opt = document.createElement('option');
    opt.value = date;
    opt.textContent = date;
    select.appendChild(opt);
  });
}

// Render list
function render() {
  const list = document.getElementById('foodList');
  const query = document.getElementById('search').value.toLowerCase();
  const sortName = document.getElementById('sortName').value;
  const sortDate = document.getElementById('sortDate').value;
  const dateFilter = document.getElementById('dateFilter').value;

  list.innerHTML = '';

  let filtered = foods.filter(food =>
    food.name.toLowerCase().includes(query)
  );

  if (dateFilter) {
    filtered = filtered.filter(food => food.date === dateFilter);
  }

  filtered.sort((a, b) => {
    const da = a.date === 'No date' ? 0 : new Date(a.date).getTime();
    const db = b.date === 'No date' ? 0 : new Date(b.date).getTime();

    return sortDate === 'newest' ? db - da : da - db;
  });

  if (sortName === 'az') {
    filtered.sort((a, b) => a.name.localeCompare(b.name));
  } else {
    filtered.sort((a, b) => b.name.localeCompare(a.name));
  }

  list.innerHTML = '';

  filtered.forEach((food, index) => {
    const div = document.createElement('div');
    div.className = 'food-card';

    const ingredientsText = food.ingredients
      .map(i => `${i.qty} ${i.unit} ${i.name}`)
      .join('\n');

    div.innerHTML = `
      <strong>${food.name}</strong><br>
      <small>Last eaten: ${food.date}</small>
      <div class="ingredients">${ingredientsText}</div>

      <button class="copy-btn" onclick="copyIngredients('${ingredientsText.replace(/'/g, "\\'")}')">
        Copy
      </button>

      <button class="edit-btn" onclick="editFood(${index})">Edit</button>
      <button class="delete-btn" onclick="deleteFood(${index})">Delete</button>
    `;

    list.appendChild(div);
  });

  updateSuggestions();
}

save();
render();
</script>

</body>
</html>
